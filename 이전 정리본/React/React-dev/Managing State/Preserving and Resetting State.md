# Preserving and Resetting State

- 각 컴포넌트는 독립된 state를 가진다.
- React는 UI 트리에서의 위치를 통해 각 state가 어떤 컴포넌트에 속하는지 추적한다.
- 리렌더링마다 언제 state를 보존하고, 초기화할지 컨트롤할 수 있다.

## UI 트리

- 브라우저는 UI를 모델링할 때 여러 트리 구조를 사용한다.
  - DOM은 HTML 엘리먼트를 나타낸다.
  - CSSOM은 CSS를 나타낸다.
  - 접근성 트리라는 것도 있다

<br />

**접근성 트리란**

- 접근성 트리는 DOM 트리의 하위 집합으로, 화면 내용을 스크린 리더와 같은 보조 기술에서 사용되는데 유용한 DOM 트리의 요소만 포함되며, 보조 기술 사용자에게 중요한 개체의 모든 속성이 포함된다.
- 개발자는 지정된 객체에 접근성 트리의 기본값을 무시하거나 객체를 사용자에게 더 잘 설명하기 위해 추가 값을 제공할 수 있다.

<br />

- React는 UI를 관리하고 모델링하기 위한 트리 구조도 가지고 있다.
- React는 JSX로 부터 **UI 트리**를 만든다.
- React DOM은 UI 트리와 일치하도록 브라우저 DOM을 업데이트 한다.

<br />

**React DOM**

- React DOM은 실제 브라우저에 존재하는 DOM 요소를 나타낸다.
- 브라우저는 HTML 문서를 로드하고 이를 파싱해서 DOM 트리를 구성한다.
- React DOM은 React 컴포넌트를 이용하여 이 실제 DOM을 조작하고 업데이트하는 역할을 한다.
- React 컴포넌트의 렌더링 결과는 React DOM을 통해 실제 DOM에 반영된다.
- React DOM은 실제로 브라우저에서 DOM 조작을 처리하기 때문에 성능상의 비용이 발생할 수 있다.

<br />

## State는 트리에서의 위치에 묶여있습니다

- state는 React 안에 있다.
- React는 컴포넌트가 UI 트리에 있는 위치를 이용해 React가 가지고 있는 각 state를 알맞은 컴포넌트와 연결한다.

<br />

- 컴포넌트를 재사용해도 각각 트리에서 자기 고유의 위치에 렌더링되어 있으므로 분리되어 있다.

  - 각 컴포넌트는 완전히 분리된 state를 가진다.

- React는 컴포넌트가 UI 트리에서 그 자리에 렌더링되는 한 state를 유지한다.
  - 만약 컴포넌트를 제거하거나 같은 자리에 다른 컴포넌트가 렌더링되면 React는 그 state를 버린다.

## 같은 자리의 같은 컴포넌트는 state를 보존합니다

- React는 props가 바뀌더라도 같은 위치에 있으면 state를 초기화 시키지 않는다.
- 예를 들어 root의 첫 번째 자식의 첫 번째 자식으로 "주소"를 생각하는 것이다.

## 같은 위치의 다른 컴포넌트는 state를 초기화합니다

- 같은 위치에 다른 컴포넌트를 렌더링할 때 컴포넌트는 그의 전체 서브 트리의 state를 초기화 한다.
- `div`의 첫 번째 자식으로 `Child`를 렌더링하다가 `section`의 첫 번째 자식으로 바꾸면, 자식 `div`가 DOM에서 제거될 때 전체 하위 트리를 제거한다.

<br />

- 경험상(rule of thumb) **리렌더링할 때 state를 유지하고 싶다면, 트리 구조가 "같아야"한다.** 만약 구조가 다르다면 React가 트리에서 컴포넌트를 지울 때 state를 지우기 때문에 state가 유지되지 않는다.

<br />

#### 주의

- 컴포넌트를 중첩해서 정의하지말고 최상위 범위에서 정의해야 한다.
  - 같은 함수에서 다른 컴포넌트를 렌더링할 때마다 React는 그 아래의 모든 state를 초기화 한다.

## 같은 위치에서 state를 초기화하기

- 기본적으로 React는 컴포넌트가 같은 위치를 유지하면 state를 유지한다.
- 컴포넌트 state를 초기화하고 싶으면 두 가지 방법이 있다.

1. 다른 위치에 컴포넌트를 렌더링하기
2. 각 컴포넌트에 `key`로 명시적인 식별자를 제공하기

### 선택지 1: 다른 위치에 컴포넌트를 렌더링하기

- 이 방법은 같은 자리에 적은 수의 독립된 컴포넌트만을 가지고 있을 때 편리하다.

```jsx
<div>
  {isPlayerA && <Counter person="Taylor" />}
  {!isPlayerA && <Counter person="Sarah" />}
</div>
```

### 선택지 2: key를 이용해 state를 초기화하기

- 배열을 렌더링할 때 처럼 `key`를 사용하면 된다.
- React가 컴포넌트를 구별할 수 있도록 `key`를 사용할 수 있다.
- `key` 자체를 명시하면 React는 부모 내에서의 순서 대신 `key` 자체를 위치의 일부로 사용한다.

#### Deep DIVE

**제거된 컴포넌트의 state를 보존하기**

- 모든 컴포넌트를 렌더링하고 CSS로 안보이게 할 수 있다.
  - 그러면 트리에서 사라지지 않을 것이고 state가 유지된다.
  - 하지만 숨겨진 트리가 커지고 많은 DOM 노드를 가지고 있다면 매우 느려질 것이다.
- state를 상위로 올리고 부모 컴포넌트에서 저장하는 것이다.
  - 이것이 가장 일반적인 해결법이다.
- React state 이외의 다른 저장소를 이용할 수 있다.
  - localStorage 에 저장하면 페이지를 닫아도 정보를 유지할 수 있다.

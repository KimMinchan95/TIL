# Updating Objects in State

- 리액트 state가 가진 객체를 직접 변경해서는 안된다.
- 객체를 업데이트하고 싶을 때는 새로운 객체를 생성하여(또는 기존 객체의 복사본을 만들어), state가 복사본을 사용하도록 해야한다.

## 변경이란?

- state에 객체를 생성했을때 기술적으로 객체 자체의 내용은 바꿀 수 있다. - 변경(mutation)

```jsx
const [position, setPosition] = useState({ x: 0, y: 0 });

position.x = 5;
```

- 하지만 state의 객체들이 기술적으로 변경 가능할지라도, 숫자, 불리언, 문자열과 같이 불변성을 가진 것처럼 다루어야 한다.
- 객체를 변경하는 대신 교체해야 한다.

## State를 읽기 전용인 것처럼 다루세요

- state에 저장한 객체는 어떠한 것이라도 읽기 전용인 것처럼 다루어야 한다.
- 리액트는 state 설정 함수가 없으면 객체가 변경되었는지 알 수 없다.

## 전개 문법으로 객체 본사하기

- 기존에 존재하는 다른 데이터를 복사하고 싶으면 `...` 객체 전개 구문을 사용하여 모든 프로퍼티를 각각 복사하지 않아도 된다.
- 하지만 전개 구문은 한 레벨 깊이의 내용만 복사하므로, 중첩된 프로퍼티를 업데이트하고 싶다면 한 번 이상 사용해야 한다.

## Immer로 간결한 갱신 로직 작성하기

- state가 깊이 중첩되어있다면 평탄화를 고려하라.
- state 구조를 바꾸고 싶지 않다면, 중첩 전개할 수 있는 Immer를 사용해서 복사본 생성을 도움 받아라.
- Immer가 제공하는 `draft`는 Proxy라고 하는 특별한 객체 타입을 사용해서 일을 "기록"하고 내부적으로 어느 부분이 변경되었는지 알아내어, 변경 사항을 포함한 완전히 새로운 객체를 생성한다.

```jsx
updatePerson((draft) => {
  draft.artwork.city = 'Lagos';
});
```

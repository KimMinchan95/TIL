# 멱등성 (Idempotency)

## 개요

멱등성은 **같은 연산을 여러 번 수행해도 결과가 한 번 수행했을 때와 동일**함을 의미한다. 분산 시스템, API 설계, 프론트엔드 상호작용에서 **안전한 재시도와 일관성**을 보장하는 핵심 개념이다.

## 정의

- **수학적 정의**: f(f(x)) = f(x)
- **시스템 관점**: 동일 입력으로 N번 호출해도 상태와 관찰 가능한 결과가 변하지 않음
- **내포 조건**: 같은 입력, 같은 환경, 부작용이 동일/없음

## HTTP/시스템에서의 멱등성

- **GET, HEAD, OPTIONS**: 읽기 전용으로 멱등적이어야 함 (캐시/프리페치 고려)
- **PUT**: 리소스를 특정 표현으로 "설정" → 같은 본문을 여러 번 보내도 결과 동일
- **DELETE**: 대상이 없어도 추가 삭제는 상태 변화 없음 → 멱등적
- **PATCH**: 부분 변경이므로 일반적으로 비멱등(서버 구현에 따라 멱등하게 설계 가능)
- **POST**: 기본적으로 비멱등 (생성/사이드이펙트). 단, **멱등성 키(Idempotency-Key)**로 멱등하게 만들 수 있음
- **재시도 전략**: 네트워크 오류/타임아웃 시 멱등 연산만 자동 재시도하는 것이 안전

## React에서의 멱등성

- **렌더 단계**: 같은 `props/state` → 같은 UI. 렌더는 **순수하고 멱등적**이어야 함 (부작용 배제)
- **StrictMode(개발)**: 렌더/이펙트 재실행으로 비멱등 부작용을 드러냄 → 이펙트는 **재실행 안전**해야 함
- **이펙트 관리**: 정리 함수(cleanup) 제공, 의존성 배열 정확히 관리, 외부 상태 갱신은 중복 호출에도 안전하도록 설계
- **상태 업데이트**: 동일 값으로 `setState`는 재렌더 스킵(동등성 비교). 이전 상태 기반 업데이트는 **함수형 업데이트**로 경쟁 조건 완화
- **전역 상태/캐시**: 요청 재시도·중복 호출에 대비해 동일 키에 대해 멱등적으로 병합/치환되도록 정책 수립

## 요약

- 멱등성은 **안전한 재시도와 일관성**을 위한 설계 원칙
- HTTP는 메서드별 멱등성 계약이 다르므로 맞는 메서드 선택이 중요
- JS/React에서는 렌더의 순수성, 이펙트의 재실행 안전성, 상태 업데이트의 결정성을 통해 멱등성을 실천한다

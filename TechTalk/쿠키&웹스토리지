# 쿠키 &  웹 스토리지

[[10분 테코톡] 🦄 디토의 웹스토리지 & 쿠키](https://www.youtube.com/watch?v=-4ZsGy1LOiE)

## 1. 쿠키

> 브라우저에 저장되는 작은 크기의 문자열(최대 4KB)
> 

Netscape에서 이미 사용자가 방문했는지 판단하기 위해 개발되었다.

- HTTP는 비연결성, 무상태성이라는 특징이 있다.
- 상태를 저장하지 않으니 정보가 저장되어 있지 않고 항상 처음 접속한 사용자로 인식한다.

### 특징

- 주로 서버에서 사용한다.
- 요청 시 Headers에 전송된다.
- 만료 기간 지정이 가능하다. (Expires, Max-Age 둘 다 존재할 경우 Max-Age만 적용)

### 종류

**영구 vs 세션**

|  | 영구 쿠기(Persistent Cookie) | 세션 쿠키(Session Cookie) |
| --- | --- | --- |
| 만료 기간 | 만료 기간 O | 만료기간 X |
| 삭제 시점 | 만료 기간이 끝난 후 삭제 | 브라우저 종료 시 삭제 |

**퍼스트파티 vs 서드파티**

|  | 퍼스트파티 쿠키(First party Cookie) | 서드파티 쿠키(Third party Cookie) |
| --- | --- | --- |
| 도메인 예시(https://botobo.kr) | 같은 도메인 botobo.kr
서브 도메인 m.botobo.kr | 다른 도메인 facebook.com |

### 문제점

- **CSRF** : 사용자의 권한을 이용한 공격 (비밀번호 변경, 결제 요청 등)
- **XSS** : 사용자의 민감한 정보 탈취 (토큰)
- **부족한 저장 용량** : 4KB
- **HTTP 요청 시 자동으로 모든 쿠키 전송** : 불필요한 트래픽 증가

## 2. 웹 스토리지

HTML 5에서 등장

- **5MB의 저장 용량** : 쿠키의 부족한 저장 용량 문제 해결
- **요청 시 Headers에 전송하지 않음** : 쿠키의 CSRF, 트래픽 문제 해결
- **문자열만 저장 가능** : 직렬화를 통해 객체 저장 가능

### 특징

|  | 로컬 스토리지 | 세션 스토리지 |
| --- | --- | --- |
| 저장 범위 | 도메인 / 브라우저 | 도메인 / 브라우저 / 탭 |
| 삭제 시기 | 직접 삭제 시 | 탭 종료 시 |

### 사용 시 고려할 점

- 웹 스토리지는 **문자열**만 저장이 가능해서 직렬화, 역직렬화 과정이 필요하다.
- 에러 처리가 필수이다. 이유는 다음과 같이 두 가지 이다.
    - 브라우저 버전에 따라 웹 스토리지를 지원하지 않을 수도 있다.
    - 웹 스토리지 비활성화 설정이 가능한 경우 에러가 발생할 수 있다. (사파리 시크릿 모드에서 웹스토리지의 할당량이 0으로 제한되어 할당량 초과라는 에러가 발생한다.)

### 문제점

- **XSS** : 자바스크립트로 접근 가능하다.
- **독립된 스토리지** : 브라우저 / 탭(세션 스토리지) 간 공유 불가하다.
- **만료 기간 설정 불가**
- **동기적으로 실행** : 메인 스레드 블로킹, 용량이 크다면 IndexedDB를 고려해야한다.

## 3. 정리

### 쿠키 & 로컬/세션 스토리지 사용처

|  | 쿠키 
- 기간 설정, 서버 전송(작은 용량) | 세션 스토리지 
- 탭 종료 시 삭제되어도 ok | 로컬 스토리지 
- 브라우저 종료 시 유지 |
| --- | --- | --- | --- |
| 사용처 | - n일 동안 보지 않기
- 비로그인 장바구니 | - 이전 페이지 저장
- 이전 스크롤 위치 저장 | - 사용자 설정 저장
- 글 임시 저장 |

### 쿠키 보안 문제 해결 방안

|  | 해결 방안 | 이유 |
| --- | --- | --- |
| XSS | HttpOnly | 자바스크립트로 접근 불가 |
| CSRF | SameSite
Referer 검증 | 같은 도메인의 요청에만 쿠키를 전송
요청 온 사이트의 도메인을 확일할 수 있음 |
- SameSite에는 2가지 옵션이 존재한다.
    - Strict : 모두 허용하지 않음
    - Lax : 안전한 GET 요청만 허용 (a tag)

### 웹 스토리지 보안 문제 해결 방안

|  | 해결 방안 | 이유 |
| --- | --- | --- |
| XSS | innerHTML 사용 X | 자바스크립트 코드 삽입 불가 |
- 사용자 입력이 자바스크립트 코드로 실행될 수 있는 코드 작성하지 않기 (innerHTML, eval, document.write)
- innerHTML을 사용해야하는 상황이면 XSS 보안 라이브러리를 사용해야 한다. (sanitize-html, DOMPurify)